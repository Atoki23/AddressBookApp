<script>
    flatpickr("#dob", {
        dateFormat: "m/d/Y",
        altInput: true,
        altFormat: "m/d/Y",
    });

    let isEditMode = false;

    document.getElementById('contactForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const contactId = document.getElementById('contactId').value;
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const dob = document.getElementById('dob').value;
        const phone = document.getElementById('phone').value;

        if (isEditMode) {
            // Update existing contact
            fetch(`/api/contacts/${contactId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ firstName, lastName, email, dob, phone }),
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else if (response.status === 404) {
                        alert('Contact not found');
                    } else {
                        throw new Error('Failed to update contact');
                    }
                })
                .then(() => {
                    alert('Contact updated successfully!');
                    resetForm();
                    loadContacts();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the contact. Please try again.');
                });
        } else {
            // Add new contact
            fetch('/api/contacts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ firstName, lastName, email, dob, phone }),
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to add contact');
                    }
                })
                .then(() => {
                    alert('Contact added successfully!');
                    resetForm();
                    loadContacts();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while adding the contact. Please try again.');
                });
        }
    });

    function loadContacts() {
        fetch('/api/contacts')
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to load contacts');
                }
            })
            .then(data => {
                const contactTable = document.getElementById('contactTable');
                contactTable.innerHTML = '';

                data.forEach(contact => {
                    const row = `<tr>
                        <td>${contact.firstName}</td>
                        <td>${contact.lastName}</td>
                        <td>${contact.email}</td>
                        <td>${contact.dob}</td>
                        <td>${contact.phone}</td>
                        <td>
                            <button onclick="editContact('${contact.id}')">Edit</button>
                            <button onclick="deleteContact('${contact.id}')">Delete</button>
                        </td>
                    </tr>`;
                    contactTable.insertAdjacentHTML('beforeend', row);
                });
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading contacts. Please try again.');
            });
    }

    function deleteContact(id) {
        if (confirm('Are you sure you want to delete this contact?')) {
            fetch(`/api/contacts/${id}`, {
                method: 'DELETE',
            })
                .then(response => {
                    if (response.ok) {
                        alert('Contact deleted successfully!');
                        loadContacts();
                    } else {
                        throw new Error('Failed to delete contact');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the contact. Please try again.');
                });
        }
    }

    function editContact(id) {
        fetch(`/api/contacts/${id}`)
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else if (response.status === 404) {
                    alert('Contact not found');
                } else {
                    throw new Error('Failed to load contact details');
                }
            })
            .then(contact => {
                document.getElementById('contactId').value = contact.id;
                document.getElementById('firstName').value = contact.firstName;
                document.getElementById('lastName').value = contact.lastName;
                document.getElementById('email').value = contact.email;
                document.getElementById('dob').value = contact.dob;
                document.getElementById('phone').value = contact.phone;

                document.getElementById('formTitle').innerText = 'Edit Contact';
                document.getElementById('submitBtn').innerText = 'Update Contact';
                document.getElementById('cancelBtn').style.display = 'inline';
                isEditMode = true;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading contact details. Please try again.');
            });
    }

    function resetForm() {
        document.getElementById('contactId').value = '';
        document.getElementById('firstName').value = '';
        document.getElementById('lastName').value = '';
        document.getElementById('email').value = '';
        document.getElementById('dob').value = '';
        document.getElementById('phone').value = '';

        document.getElementById('formTitle').innerText = 'Add New Contact';
        document.getElementById('submitBtn').innerText = 'Add Contact';
        document.getElementById('cancelBtn').style.display = 'none';
        isEditMode = false;
    }

    document.getElementById('cancelBtn').addEventListener('click', resetForm);

    window.onload = loadContacts;
</script>










